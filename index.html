<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernpfad: Die Sprache der Computer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .mono { font-family: 'Fira Code', monospace; }
        .step-content { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .step-content.active { display: block; opacity: 1; }
        
        .bit-btn { transition: all 0.2s; }
        .bit-btn.active { background-color: #3b82f6; color: white; box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); transform: scale(1.05); }
        
        .carry-input { width: 2rem; height: 2rem; text-align: center; background-color: #1e293b; border: 1px solid #475569; color: #fbbf24; border-radius: 0.375rem; }
        .carry-input:focus { border-color: #fbbf24; box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2); }
        
        .chart-container { position: relative; width: 100%; max-width: 600px; margin: 0 auto; height: 250px; }
        
        /* Didaktische Farben */
        .color-pos-0 { border-color: #ec4899; } .bg-pos-0 { background-color: #ec4899; }
        .color-pos-1 { border-color: #8b5cf6; } .bg-pos-1 { background-color: #8b5cf6; }
        .color-pos-2 { border-color: #3b82f6; } .bg-pos-2 { background-color: #3b82f6; }
        
        .error-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; border-color: #ef4444 !important; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .pixel-grid-btn { width: 100%; aspect-ratio: 1; border-radius: 4px; border: 1px solid #cbd5e1; transition: all 0.1s; }
        .pixel-on { background-color: #0f172a; border-color: #0f172a; }
        .pixel-off { background-color: #ffffff; }
        
        .rule-card { background: rgba(255,255,255,0.9); padding: 0.5rem; border-radius: 0.5rem; border: 1px solid #e2e8f0; font-family: monospace; text-align: center; }
        .hex-cell { border: 1px solid #e2e8f0; padding: 4px; text-align: center; font-size: 0.75rem; font-family: 'Fira Code', monospace; }
        .hex-head { background-color: #f1f5f9; font-weight: bold; }

        .task-badge { background: #e2e8f0; color: #475569; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body class="text-slate-900 overflow-x-hidden">

<div class="min-h-screen flex flex-col">
    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 px-4 py-3 shadow-sm">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üëæ</span>
                <span class="font-extrabold tracking-tight text-slate-800 uppercase text-sm sm:text-base">Binary Explorer</span>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="progress-nav" class="hidden md:flex gap-4 lg:gap-6 overflow-x-auto">
                    <div class="flex items-center gap-1 text-xs font-bold text-slate-400 whitespace-nowrap" id="nav-1"><span>1. Bits</span></div>
                    <div class="flex items-center gap-1 text-xs font-bold text-slate-400 whitespace-nowrap" id="nav-2"><span>2. Decoder</span></div>
                    <div class="flex items-center gap-1 text-xs font-bold text-slate-400 whitespace-nowrap" id="nav-3"><span>3. Addierer</span></div>
                    <div class="flex items-center gap-1 text-xs font-bold text-slate-400 whitespace-nowrap" id="nav-4"><span>4. Multiplikator</span></div>
                    <div class="flex items-center gap-1 text-xs font-bold text-amber-500 whitespace-nowrap hidden" id="nav-6"><span>‚òÖ Grafik</span></div>
                    <div class="flex items-center gap-1 text-xs font-bold text-purple-600 whitespace-nowrap hidden" id="nav-7"><span>‚òÖ Hex-Code</span></div>
                    <div class="flex items-center gap-1 text-xs font-bold text-slate-800 whitespace-nowrap hidden" id="nav-8"><span>‚òÖ Master-Check</span></div>
                </div>
                <button onclick="app.downloadReport()" class="flex items-center gap-2 bg-slate-800 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-slate-700 transition shadow-sm ml-2">
                    <span>üíæ</span> <span class="hidden sm:inline">Ergebnis speichern</span>
                </button>
            </div>
        </div>
        <div class="mt-2 w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
            <div id="progress-bar-fill" class="bg-blue-600 h-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </nav>

    <main class="flex-grow max-w-4xl w-full mx-auto px-4 py-8 sm:py-12">
        
        <!-- Toast -->
        <div id="toast" class="fixed top-20 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-xl transform translate-x-full transition-transform duration-300 z-50 font-bold flex items-center gap-2">
            <span>‚úÖ</span> <span id="toast-msg">Gespeichert!</span>
        </div>

        <!-- STEP 0: START -->
        <section id="step-0" class="step-content active">
            <div class="text-center mb-12">
                <h1 class="text-4xl sm:text-5xl font-black text-slate-800 mb-6 tracking-tight">Hallo Informatiker! üëã</h1>
                <p class="text-slate-600 max-w-2xl mx-auto text-lg leading-relaxed">
                    W√§hle deinen Lernpfad. Jede Station enth√§lt nun mehrere Aufgaben mit steigender Schwierigkeit.
                </p>
                <div id="restore-msg" class="hidden mt-4 bg-blue-50 text-blue-700 px-4 py-2 rounded-lg inline-block text-sm font-bold border border-blue-200">
                    üîÑ Spielstand geladen!
                </div>
            </div>
            <div class="grid md:grid-cols-2 gap-6">
                <button onclick="app.selectPath('guided')" class="group p-8 bg-white border-2 border-slate-200 rounded-3xl text-left hover:border-blue-500 transition-all shadow-sm hover:shadow-xl hover:-translate-y-1">
                    <div class="text-5xl mb-4">üß≠</div>
                    <h3 class="text-2xl font-bold mb-2 text-slate-800">Gef√ºhrte Tour</h3>
                    <p class="text-slate-500 text-sm">Mit Erkl√§rungen und Tipps.</p>
                </button>
                <button onclick="app.selectPath('discovery')" class="group p-8 bg-white border-2 border-slate-200 rounded-3xl text-left hover:border-indigo-500 transition-all shadow-sm hover:shadow-xl hover:-translate-y-1">
                    <div class="text-5xl mb-4">üöÄ</div>
                    <h3 class="text-2xl font-bold mb-2 text-slate-800">Entdecker-Mission</h3>
                    <p class="text-slate-500 text-sm">Herausfordernd, weniger Hilfe.</p>
                </button>
            </div>
        </section>

        <!-- STEP 1: BASIS -->
        <section id="step-1" class="step-content">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <span class="text-blue-600 font-bold tracking-widest text-xs uppercase">Station 1</span>
                    <h2 class="text-3xl font-black text-slate-800 mb-2">Das Bit-Prinzip</h2>
                </div>
                <button onclick="app.prevStep()" class="text-slate-400 hover:text-slate-600 font-bold text-sm px-3 py-2 rounded-lg hover:bg-slate-100 transition">‚Üê Zur√ºck</button>
            </div>
            
            <div class="mb-6"><span id="s1-progress" class="task-badge">Aufgabe 1 von 3</span></div>
            <p class="text-slate-600 mb-8" id="intro-text-1"></p>
            
            <div class="bg-slate-900 rounded-3xl p-6 sm:p-10 text-white shadow-2xl mb-8">
                <div class="text-center mb-8 text-slate-400 text-sm">Kombiniere die Schalter zur Zielsumme</div>
                <div id="switches-ui" class="flex flex-wrap justify-center gap-4 mb-10"></div>
                <div class="flex justify-between items-end border-t border-slate-700 pt-6">
                    <div>
                        <div class="text-[10px] uppercase text-slate-500 font-bold mb-1">Code</div>
                        <div class="text-slate-300 mono text-2xl tracking-widest" id="binary-display">0000</div>
                    </div>
                    <div class="text-right">
                        <div class="text-[10px] uppercase text-slate-500 font-bold mb-1">Wert</div>
                        <div class="text-5xl font-black text-blue-400 mono"><span id="sum-display">0</span> <span class="text-slate-600 text-2xl font-normal">/ <span id="target-display">?</span></span></div>
                    </div>
                </div>
            </div>
            <div id="feedback-1" class="hidden text-center bg-green-50 p-6 rounded-2xl border border-green-200 animate-bounce-in">
                <p class="text-green-800 font-bold mb-4" id="feedback-text-1">üéâ Richtig!</p>
                <button onclick="app.nextTask1()" id="btn-next-task-1" class="px-8 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg">N√§chste Aufgabe ‚ûî</button>
            </div>
        </section>

        <!-- STEP 2: UMWANDLUNG -->
        <section id="step-2" class="step-content">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <span class="text-blue-600 font-bold tracking-widest text-xs uppercase">Station 2</span>
                    <h2 class="text-3xl font-black text-slate-800 mb-2">Der Zahlen-Dolmetscher</h2>
                </div>
                <button onclick="app.prevStep()" class="text-slate-400 hover:text-slate-600 font-bold text-sm px-3 py-2 rounded-lg hover:bg-slate-100 transition">‚Üê Zur√ºck</button>
            </div>
            
            <div class="mb-6"><span id="s2-progress" class="task-badge">Aufgabe 1 von 4</span></div>
            <p class="text-slate-600 mb-8">√úbersetze zwischen den Welten. Schwierigkeit steigt!</p>

            <div class="bg-white p-8 rounded-3xl border-2 border-slate-100 shadow-lg max-w-xl mx-auto text-center">
                <h3 class="font-bold mb-2 text-slate-800 text-xl" id="s2-mode-title">Vom Code zur Zahl</h3>
                <p class="text-xs text-slate-400 mb-6 uppercase tracking-wider" id="s2-mode-sub">Bin√§r ‚Üí Dezimal</p>
                
                <div class="text-4xl font-black mono text-center py-6 bg-slate-50 text-slate-700 rounded-2xl mb-6 border border-slate-200" id="s2-val">?</div>
                
                <input type="text" id="input-s2" class="w-full p-4 border-2 rounded-xl mb-4 outline-none focus:border-blue-500 transition text-center text-xl font-mono" placeholder="Ergebnis eingeben">
                
                <button onclick="app.checkStation2()" class="w-full bg-slate-900 text-white p-4 rounded-xl font-bold hover:bg-slate-800 transition text-lg">√úberpr√ºfen</button>
                <div id="msg-s2" class="text-center mt-4 font-bold h-6 text-sm"></div>
                
                <button id="btn-next-s2" onclick="app.nextTask2()" class="hidden w-full mt-4 bg-green-600 text-white p-4 rounded-xl font-bold hover:bg-green-700 transition shadow-lg">N√§chste Aufgabe ‚ûî</button>
            </div>
        </section>

        <!-- STEP 3: ADDITION -->
        <section id="step-3" class="step-content">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <span class="text-blue-600 font-bold tracking-widest text-xs uppercase">Station 3</span>
                    <h2 class="text-3xl font-black text-slate-800 mb-2">Das Rechenwerk</h2>
                </div>
                <button onclick="app.prevStep()" class="text-slate-400 hover:text-slate-600 font-bold text-sm px-3 py-2 rounded-lg hover:bg-slate-100 transition">‚Üê Zur√ºck</button>
            </div>
            
            <div class="mb-6"><span id="s3-progress" class="task-badge">Aufgabe 1 von 3</span></div>
            
            <div class="bg-blue-50/50 border-l-4 border-blue-500 p-6 rounded-r-xl mb-8 text-sm text-slate-700 leading-relaxed shadow-sm">
                <h3 class="font-bold text-blue-800 mb-4 text-lg">üí° Regeln & √úbertrag</h3>
                <div class="grid grid-cols-2 gap-4 mb-4 font-mono text-center">
                    <div class="bg-white p-2 rounded border border-slate-200">0+0=<b>0</b></div>
                    <div class="bg-white p-2 rounded border border-slate-200">0+1=<b>1</b></div>
                    <div class="bg-white p-2 rounded border border-slate-200">1+0=<b>1</b></div>
                    <div class="bg-yellow-50 p-2 rounded border border-yellow-200">1+1=<b>0</b> <span class="text-red-500 text-xs">(C:1)</span></div>
                </div>
                <p><b>Wichtig:</b> Trage den √úbertrag (1) immer in das kleine K√§stchen der <b>n√§chsten Spalte links</b> ein.</p>
            </div>

            <div class="bg-slate-900 text-white p-8 sm:p-12 rounded-3xl shadow-2xl max-w-lg mx-auto relative overflow-hidden">
                <div class="flex flex-col items-end mono relative z-10">
                    <div class="text-[10px] text-slate-500 uppercase tracking-widest mb-1 pr-1">√úbertrag</div>
                    <div class="flex gap-2 sm:gap-4 mb-4 pr-2" id="carry-inputs"></div>
                    
                    <div class="text-4xl sm:text-5xl tracking-[0.2em] mb-2 pr-2" id="add-val1">?</div>
                    <div class="text-4xl sm:text-5xl tracking-[0.2em] border-b-4 border-slate-700 pb-4 mb-6 flex items-center pr-2 w-full justify-end">
                        <span class="text-2xl text-slate-600 mr-4 absolute left-8">+</span><span id="add-val2">?</span>
                    </div>
                    
                    <input type="text" id="input-add" class="bg-slate-800 text-green-400 text-right text-4xl sm:text-5xl tracking-[0.2em] w-full p-4 rounded-xl outline-none focus:ring-2 focus:ring-green-400 transition" placeholder="?????">
                </div>
            </div>
            <div class="mt-8 text-center">
                <button onclick="app.checkAddition()" class="px-10 py-4 bg-green-600 text-white rounded-2xl font-black hover:bg-green-700 transition shadow-lg">Pr√ºfen</button>
                <div id="msg-add" class="mt-4 font-bold h-6"></div>
                <button id="btn-next-s3" onclick="app.nextTask3()" class="hidden mt-6 px-8 py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-700 transition">N√§chste Aufgabe ‚ûî</button>
            </div>
        </section>

        <!-- STEP 4: MULTIPLIKATION -->
        <section id="step-4" class="step-content">
            <div class="flex items-center justify-between mb-8">
                <div>
                    <span class="text-orange-500 font-bold tracking-widest text-xs uppercase">Station 4</span>
                    <h2 class="text-3xl font-black text-slate-800 mb-2">Shift & Add</h2>
                </div>
                <button onclick="app.prevStep()" class="text-slate-400 hover:text-slate-600 font-bold text-sm px-3 py-2 rounded-lg hover:bg-slate-100 transition">‚Üê Zur√ºck</button>
            </div>

            <!-- Phase 1: Experiment -->
            <div id="mult-phase-1" class="mb-12 transition-all duration-500">
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm mb-6">
                    <h3 class="font-bold text-slate-800 mb-2">üî¨ Phase 1: Das Prinzip</h3>
                    <p class="text-sm text-slate-600">Klicke auf die Stellenwerte (unten). Verstehe, wie sich die Zahl verschiebt.</p>
                </div>
                <div class="bg-slate-900 rounded-3xl p-8 text-white shadow-xl mb-8 border border-slate-800">
                    <div class="flex flex-col items-center gap-8">
                        <div class="flex items-center gap-4 sm:gap-6 text-2xl sm:text-3xl mono">
                            <span class="text-blue-400" id="sim-val1">110</span> <span class="text-slate-600">√ó</span> <div id="sim-val2-container" class="flex gap-3 sm:gap-4"></div>
                        </div>
                        <div class="w-full border-t border-slate-800 pt-8"><div id="sim-workspace" class="space-y-3 min-h-[140px] flex flex-col items-end justify-start"></div></div>
                    </div>
                </div>
                <div class="text-center"><button onclick="app.checkSimPhase()" id="btn-check-sim" class="hidden px-10 py-4 bg-blue-600 text-white rounded-2xl font-black shadow-xl hover:bg-blue-700 transition-all">Weiter zu den Aufgaben ‚ûî</button></div>
            </div>

            <!-- Phase 2: Tasks -->
            <div id="mult-phase-2" class="hidden opacity-0 transition-opacity duration-700">
                <div class="mb-6 flex justify-between items-center">
                    <h3 class="text-xl font-bold text-slate-800">üìù Phase 2: Rechnen</h3>
                    <span id="s4-progress" class="task-badge">Aufgabe 1 von 3</span>
                </div>
                
                <div class="bg-slate-900 p-8 sm:p-10 rounded-3xl text-white shadow-2xl max-w-xl mx-auto w-full">
                    <div class="mono text-center text-3xl sm:text-4xl mb-10 text-orange-400 font-bold" id="final-mult-task">?</div>
                    <div class="space-y-4 mb-8" id="final-partial-rows"></div>
                    <div class="pt-8 border-t border-slate-700">
                        <label class="block text-xs uppercase font-bold text-slate-500 mb-3 tracking-widest text-center">Gesamtergebnis</label>
                        <input type="text" id="final-mult-res" class="w-full bg-slate-800 p-4 border-2 border-slate-700 rounded-2xl mono text-3xl text-center text-green-400 outline-none focus:border-green-400 transition" placeholder="?????">
                        <button onclick="app.checkFinalMult()" class="w-full mt-6 py-4 bg-orange-600 rounded-2xl font-black text-lg hover:bg-orange-700 transition shadow-lg">Pr√ºfen</button>
                    </div>
                    <div id="msg-mult-final" class="mt-4 text-center font-bold text-lg h-6"></div>
                    <button id="btn-next-s4" onclick="app.nextTask4()" class="hidden w-full mt-6 py-4 bg-slate-700 hover:bg-slate-600 rounded-2xl font-bold transition">N√§chste Aufgabe ‚ûî</button>
                </div>
            </div>
            
            <button id="next-btn-final" onclick="app.nextStep()" class="hidden mt-12 w-full py-5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-black text-xl shadow-xl transition">Station abschlie√üen ‚úÖ</button>
        </section>

        <!-- STEP 6: BONUS -->
        <section id="step-6" class="step-content">
            <div class="flex items-center justify-between mb-8">
                <div><span class="text-amber-500 font-bold tracking-widest text-xs uppercase">Bonus-Level</span><h2 class="text-3xl font-black text-slate-800 mb-2">Der Grafikspeicher</h2></div>
                <button onclick="app.prevStep()" class="text-slate-400 hover:text-slate-600 font-bold text-sm px-3 py-2 rounded-lg hover:bg-slate-100 transition">‚Üê Zur√ºck</button>
            </div>
            <p class="text-slate-600 text-center mb-8">Zeichne den Smiley: <b>1=Schwarz</b>, <b>0=Wei√ü</b>.</p>
            <div class="grid md:grid-cols-2 gap-8 items-start max-w-3xl mx-auto">
                <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm text-center">
                    <div class="grid grid-cols-5 gap-1 w-40 mx-auto aspect-square p-2 bg-slate-100 rounded-lg">
                        <!-- Smiley Template -->
                        <div class="bg-white rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-white rounded-sm"></div>
                        <div class="bg-white rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-white rounded-sm"></div>
                        <div class="bg-white rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-white rounded-sm"></div>
                        <div class="bg-slate-900 rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-white rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div>
                        <div class="bg-white rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-slate-900 rounded-sm"></div><div class="bg-white rounded-sm"></div>
                    </div>
                </div>
                <div class="bg-slate-900 p-6 rounded-3xl shadow-xl text-white">
                    <div id="pixel-rows" class="space-y-3"></div>
                    <button onclick="app.checkBonus()" class="w-full mt-6 py-3 bg-blue-600 rounded-xl font-bold hover:bg-blue-700 transition">Rendern</button>
                    <div id="bonus-msg" class="text-center mt-4 h-6 font-bold text-sm"></div>
                </div>
            </div>
            <div class="text-center mt-8"><button onclick="app.startProfi()" class="text-slate-500 hover:text-purple-600 underline font-bold">‚ûî Weiter zum Profi-Level</button></div>
        </section>

        <!-- STEP 7: HEX (UPDATED: 3 TASKS) -->
        <section id="step-7" class="step-content">
            <div class="flex items-center justify-between mb-8">
                <div class="text-center w-full"><span class="text-purple-600 font-bold tracking-widest text-xs uppercase">Profi-Station</span><h2 class="text-3xl font-black text-slate-800 mb-2">Hexadezimal-Code</h2></div>
                <button onclick="app.prevStep()" class="absolute right-4 text-slate-400 hover:text-slate-600 font-bold text-sm px-3 py-2 rounded-lg hover:bg-slate-100 transition">‚Üê Zur√ºck</button>
            </div>
            <div class="mb-4 text-center"><span id="s7-progress" class="task-badge">Code 1 von 3</span></div>
            
            <div class="max-w-4xl mx-auto bg-white p-6 rounded-3xl border border-slate-200 shadow-sm mb-8">
                <div class="grid grid-cols-8 sm:grid-cols-16 gap-1 text-[10px] mb-6">
                    <div class="hex-cell hex-head">0</div><div class="hex-cell hex-head">1</div><div class="hex-cell hex-head">2</div><div class="hex-cell hex-head">3</div><div class="hex-cell hex-head">4</div><div class="hex-cell hex-head">5</div><div class="hex-cell hex-head">6</div><div class="hex-cell hex-head">7</div>
                    <div class="hex-cell hex-head">8</div><div class="hex-cell hex-head">9</div><div class="hex-cell hex-head">10</div><div class="hex-cell hex-head">11</div><div class="hex-cell hex-head">12</div><div class="hex-cell hex-head">13</div><div class="hex-cell hex-head">14</div><div class="hex-cell hex-head">15</div>
                    <div class="hex-cell">0</div><div class="hex-cell">1</div><div class="hex-cell">2</div><div class="hex-cell">3</div><div class="hex-cell">4</div><div class="hex-cell">5</div><div class="hex-cell">6</div><div class="hex-cell">7</div>
                    <div class="hex-cell">8</div><div class="hex-cell">9</div><div class="hex-cell font-bold text-purple-600">A</div><div class="hex-cell font-bold text-purple-600">B</div><div class="hex-cell font-bold text-purple-600">C</div><div class="hex-cell font-bold text-purple-600">D</div><div class="hex-cell font-bold text-purple-600">E</div><div class="hex-cell font-bold text-purple-600">F</div>
                </div>

                <div class="bg-slate-900 rounded-2xl p-8 text-center text-white">
                    <h3 class="font-bold text-purple-300 mb-6 uppercase tracking-widest">Hacker Challenge</h3>
                    <p class="text-sm text-slate-400 mb-2">√úbersetze in Hex:</p>
                    <div class="text-4xl mono tracking-widest mb-6" id="hex-task-display"></div>
                    <div class="flex justify-center gap-4 items-center" id="hex-inputs"></div>
                    <button onclick="app.checkHex()" class="mt-8 px-8 py-3 bg-purple-600 hover:bg-purple-700 rounded-xl font-bold transition shadow-lg">Code knacken</button>
                    <div id="hex-msg" class="mt-4 font-bold h-6"></div>
                    <button id="btn-next-s7" onclick="app.nextTask7()" class="hidden w-full max-w-xs mx-auto mt-6 py-3 bg-slate-700 rounded-xl font-bold hover:bg-slate-600 transition">N√§chster Code ‚ûî</button>
                </div>
            </div>
            <button id="next-btn-hex" onclick="app.nextStep()" class="hidden w-full max-w-md mx-auto block py-4 bg-slate-800 text-white rounded-2xl font-black shadow-lg hover:bg-black transition">Zum Finale üèÅ</button>
        </section>

        <!-- STEP 8: FINAL QUIZ -->
        <section id="step-8" class="step-content">
            <div class="text-center w-full mb-8"><span class="text-red-500 font-bold tracking-widest text-xs uppercase">Finale</span><h2 class="text-4xl font-black text-slate-800 mb-2">System-Check</h2></div>
            <div class="max-w-2xl mx-auto space-y-6">
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm quiz-card" id="q1">
                    <h4 class="font-bold text-slate-700 mb-2">1. Umwandlung</h4>
                    <p class="text-sm mb-4">Dezimalwert von <code>0010 1101</code>?</p>
                    <input type="number" id="ans-q1" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500" placeholder="Antwort">
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm quiz-card" id="q2">
                    <h4 class="font-bold text-slate-700 mb-2">2. Rechnen</h4>
                    <p class="text-sm mb-4"><code>1010 + 0110</code> (Bin√§r)?</p>
                    <input type="text" id="ans-q2" class="w-full p-3 border rounded-xl outline-none focus:border-blue-500 mono" placeholder="Antwort">
                </div>
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm quiz-card" id="q3">
                    <h4 class="font-bold text-slate-700 mb-2">3. Logik</h4>
                    <p class="text-sm mb-4">Wie viele Zahlen mit 5 Bit?</p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="app.selectQuizOpt(this, 16)" class="quiz-opt p-3 border rounded-xl hover:bg-slate-50">16</button>
                        <button onclick="app.selectQuizOpt(this, 32)" class="quiz-opt p-3 border rounded-xl hover:bg-slate-50">32</button>
                        <button onclick="app.selectQuizOpt(this, 64)" class="quiz-opt p-3 border rounded-xl hover:bg-slate-50">64</button>
                    </div>
                </div>
                <button onclick="app.checkFinalQuiz()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black shadow-xl hover:scale-105 transition">Pr√ºfung abgeben</button>
                <div id="quiz-result" class="text-center font-bold text-xl mt-4 hidden"></div>
            </div>
        </section>

        <!-- STEP 5 (SUMMARY SCREEN FOR REGULAR PATH) -->
        <section id="step-5" class="step-content">
            <div class="max-w-2xl mx-auto text-center py-12 bg-white rounded-3xl shadow-xl border border-slate-100 mb-10">
                <div class="text-8xl mb-6 animate-bounce">üèÜ</div>
                <h2 class="text-4xl font-black text-slate-800 mb-4 tracking-tight">Grundkurs Abgeschlossen!</h2>
                <p class="text-lg text-slate-500 mb-8 px-6">Du hast die Grundlagen der digitalen Welt gemeistert.</p>
                <div class="flex justify-center gap-4">
                    <button onclick="app.startBonus()" class="px-6 py-3 bg-amber-500 text-white rounded-xl font-bold shadow-md hover:bg-amber-600 transition">üëæ Pixel Art</button>
                    <button onclick="app.startProfi()" class="px-6 py-3 bg-purple-600 text-white rounded-xl font-bold shadow-md hover:bg-purple-700 transition">üß¨ Profi-Hex</button>
                </div>
            </div>
        </section>

    </main>
</div>

<script>
const app = {
    state: {
        step: 0, path: '', currentSum: 0,
        subStep: { s1:0, s2:0, s3:0, s4:0, s7:0 },
        tasks: { 
            s1: [], // Generated dynamically
            s2: [
                { type:'bin2dec', q:'0101', a:'5', bits:4 }, 
                { type:'dec2bin', q:'10', a:'1010', bits:4 },
                { type:'bin2dec', q:'00011001', a:'25', bits:8 },
                { type:'dec2bin', q:'50', a:'110010', bits:8 }
            ],
            s3: [
                { v1:'100', v2:'010', res:'110', car:'000' }, // Simple
                { v1:'101', v2:'001', res:'110', car:'010' }, // 1 Carry
                { v1:'011', v2:'001', res:'100', car:'110' }  // Cascade
            ],
            s4: [
                { v1:'10', v2:'10', res:'100', p:['100','00'] },
                { v1:'110', v2:'10', res:'1100', p:['1100','000'] },
                { v1:'111', v2:'101', res:'100011', p:['11100','0000','111'] }
            ],
            s7: [
                { bin:['1010'], hex:['A'] },
                { bin:['1111','0000'], hex:['F','0'] },
                { bin:['1011','1100'], hex:['B','C'] }
            ]
        },
        simActiveBits: new Set(),
        bonusSolution: ['01010', '01010', '00000', '10001', '01110'],
        q3Ans: null
    },

    init() { this.loadState(); this.updateProgress(); },

    /* CORE NAVIGATION & STATE */
    saveState() { localStorage.setItem('binState', JSON.stringify(this.state)); document.getElementById('toast').classList.remove('translate-x-full'); setTimeout(()=>document.getElementById('toast').classList.add('translate-x-full'),2000); },
    loadState() {
        const s = localStorage.getItem('binState');
        if(s) { 
            try {
                const loaded = JSON.parse(s);
                // Schema check: Ensure new structure exists (subStep and tasks.s2 as array)
                if (loaded.subStep && loaded.tasks && Array.isArray(loaded.tasks.s2)) {
                    this.state = loaded;
                    if(this.state.step > 0) {
                        document.getElementById('restore-msg').classList.remove('hidden');
                        document.getElementById('progress-nav').classList.remove('hidden');
                        this.render();
                        // Re-init dynamic tasks if needed
                        if(this.state.step >= 1 && this.state.tasks.s1.length === 0) {
                             this.initTasksS1();
                        }
                        if(this.state.step === 1) this.setupStep1();
                        else this.autoSetup();
                    }
                } else {
                    console.log("Incompatible save found. Resetting.");
                    localStorage.removeItem('binState');
                }
            } catch(e) {
                console.error("Save file corrupted", e);
                localStorage.removeItem('binState');
            }
        }
    },
    downloadReport() {
        const txt = `Binary Report\nStation: ${this.state.step}\nTasks Completed:\nS1: ${this.state.subStep.s1}\nS2: ${this.state.subStep.s2}\nS3: ${this.state.subStep.s3}`;
        const b = new Blob([txt],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(b); a.download='report.txt'; a.click();
    },
    selectPath(p) { this.state.path=p; this.state.step=1; this.initTasksS1(); document.getElementById('progress-nav').classList.remove('hidden'); this.saveState(); this.render(); this.setupStep1(); },
    prevStep() { if(this.state.step>0) { this.state.step--; this.saveState(); this.render(); this.autoSetup(); } },
    nextStep() { this.state.step++; if([5,8].includes(this.state.step)) confetti({particleCount:150}); this.saveState(); this.render(); this.autoSetup(); window.scrollTo(0,0); },
    startBonus() { this.state.step=6; this.saveState(); this.render(); this.setupBonus(); window.scrollTo(0,0); },
    startProfi() { this.state.step=7; this.saveState(); this.render(); this.setupStep7(); window.scrollTo(0,0); },
    
    autoSetup() {
        if(this.state.step===1) this.setupStep1();
        if(this.state.step===2) this.setupStep2();
        if(this.state.step===3) this.setupStep3();
        if(this.state.step===4) this.setupStep4();
        if(this.state.step===7) this.setupStep7();
    },
    render() {
        document.querySelectorAll('.step-content').forEach(s=>s.classList.remove('active'));
        document.getElementById('step-'+this.state.step)?.classList.add('active');
        this.updateProgress();
    },
    updateProgress() { document.getElementById('progress-bar-fill').style.width = `${(this.state.step/8)*100}%`; },
    cleanBin(v) { return v.replace(/\s+/g,'').replace(/[^01]/g,'')||'0'; },

    /* STATION 1 */
    initTasksS1() {
        // Progressive targets: Easy -> Medium -> Hard
        const bits = this.state.path==='discovery'?6:4;
        this.state.tasks.s1 = this.state.path==='guided' ? [3, 9, 14] : [11, 43, 60];
    },
    setupStep1() {
        this.state.currentSum=0;
        const taskIdx = this.state.subStep.s1;
        const targets = this.state.tasks.s1;
        if(taskIdx >= targets.length) { this.nextStep(); return; } // Safety
        
        document.getElementById('s1-progress').textContent = `Aufgabe ${taskIdx+1} von ${targets.length}`;
        const target = targets[taskIdx];
        document.getElementById('target-display').textContent = target;
        document.getElementById('intro-text-1').textContent = `Ziel: Kombiniere die Schalter zur Summe ${target}.`;
        
        // Render UI
        const bits = this.state.path==='discovery'?6:4;
        const ui = document.getElementById('switches-ui'); ui.innerHTML='';
        for(let i=bits-1; i>=0; i--) {
            const val = Math.pow(2,i);
            const d = document.createElement('div'); d.className="text-center";
            d.innerHTML=`<div class="text-[10px] mb-2 font-bold text-slate-500">${this.state.path==='guided'?val:'?'}</div>
            <button onclick="app.toggleBit(this,${val})" class="bit-btn w-12 h-16 bg-slate-800 rounded-xl font-black text-slate-500 border-b-4 border-slate-950">0</button>`;
            ui.appendChild(d);
        }
        document.getElementById('sum-display').textContent="0";
        document.getElementById('binary-display').textContent="0".repeat(bits);
        document.getElementById('feedback-1').classList.add('hidden');
    },
    toggleBit(btn, v) {
        btn.classList.toggle('active'); const on=btn.classList.contains('active');
        btn.textContent = on?'1':'0'; btn.classList.toggle('text-white',on);
        this.state.currentSum += (on?v:-v);
        document.getElementById('sum-display').textContent=this.state.currentSum;
        document.getElementById('binary-display').textContent=Array.from(document.querySelectorAll('.bit-btn')).map(b=>b.textContent).join('');
        
        const target = this.state.tasks.s1[this.state.subStep.s1];
        if(this.state.currentSum === target) {
            document.getElementById('feedback-text-1').textContent = `üéâ Richtig! ${target} gefunden.`;
            document.getElementById('feedback-1').classList.remove('hidden');
            const isLast = this.state.subStep.s1 >= this.state.tasks.s1.length-1;
            document.getElementById('btn-next-task-1').textContent = isLast ? "Station abschlie√üen" : "N√§chste Aufgabe ‚ûî";
            document.getElementById('btn-next-task-1').onclick = isLast ? () => app.nextStep() : () => app.nextTask1();
        }
    },
    nextTask1() { this.state.subStep.s1++; this.saveState(); this.setupStep1(); },

    /* STATION 2 */
    setupStep2() {
        const taskIdx = this.state.subStep.s2;
        const tasks = this.state.tasks.s2;
        if(taskIdx >= tasks.length) { this.nextStep(); return; }

        document.getElementById('s2-progress').textContent = `Aufgabe ${taskIdx+1} von ${tasks.length}`;
        const t = tasks[taskIdx];
        
        document.getElementById('s2-mode-title').textContent = t.type==='bin2dec' ? "Vom Code zur Zahl" : "Von der Zahl zum Code";
        document.getElementById('s2-mode-sub').textContent = t.type==='bin2dec' ? "Bin√§r ‚Üí Dezimal" : "Dezimal ‚Üí Bin√§r";
        document.getElementById('s2-val').textContent = t.q;
        document.getElementById('input-s2').value = "";
        document.getElementById('input-s2').placeholder = t.type==='bin2dec' ? "Dezimalzahl..." : "0101...";
        document.getElementById('msg-s2').textContent = "";
        document.getElementById('btn-next-s2').classList.add('hidden');
    },
    checkStation2() {
        const t = this.state.tasks.s2[this.state.subStep.s2];
        const val = document.getElementById('input-s2').value.trim();
        const cleanVal = t.type==='dec2bin' ? this.cleanBin(val) : val;
        
        // Strict check
        let ok = false;
        if(t.type==='bin2dec') ok = parseInt(val) === parseInt(t.a);
        else ok = parseInt(cleanVal,2) === parseInt(t.a,2);

        const m = document.getElementById('msg-s2');
        if(ok) {
            m.textContent = "‚úÖ Korrekt!"; m.className="text-green-600 mt-4 font-bold";
            document.getElementById('btn-next-s2').classList.remove('hidden');
            const isLast = this.state.subStep.s2 >= this.state.tasks.s2.length-1;
            document.getElementById('btn-next-s2').textContent = isLast ? "Station abschlie√üen" : "N√§chste Aufgabe ‚ûî";
            document.getElementById('btn-next-s2').onclick = isLast ? () => app.nextStep() : () => app.nextTask2();
        } else {
            m.textContent = "‚ùå Leider falsch."; m.className="text-red-500 mt-4 font-bold";
        }
    },
    nextTask2() { this.state.subStep.s2++; this.saveState(); this.setupStep2(); },

    /* STATION 3 */
    setupStep3() {
        const taskIdx = this.state.subStep.s3;
        const tasks = this.state.tasks.s3;
        if(taskIdx >= tasks.length) { this.nextStep(); return; } // Safety
        
        document.getElementById('s3-progress').textContent = `Aufgabe ${taskIdx+1} von ${tasks.length}`;
        const t = tasks[taskIdx];
        
        document.getElementById('add-val1').textContent = t.v1;
        document.getElementById('add-val2').textContent = t.v2;
        const c = document.getElementById('carry-inputs'); c.innerHTML='';
        const len = Math.max(t.v1.length, t.res.length);
        for(let i=0; i<len; i++) {
            const inp = document.createElement('input'); inp.className="carry-input"; inp.id="carry-"+(len-1-i); c.appendChild(inp);
        }
        document.getElementById('input-add').value="";
        document.getElementById('msg-add').textContent="";
        document.getElementById('btn-next-s3').classList.add('hidden');
    },
    checkAddition() {
        const t = this.state.tasks.s3[this.state.subStep.s3];
        const uR = this.cleanBin(document.getElementById('input-add').value);
        let uC = ""; const len = Math.max(t.v1.length, t.res.length);
        for(let i=len-1; i>=0; i--) uC += (document.getElementById('carry-'+i).value.trim() || '0');
        uC = uC.replace(/^0+/,'') || '0'; 
        const tC = t.car.replace(/^0+/,'') || '0';

        const m = document.getElementById('msg-add');
        if(parseInt(uR,2)===parseInt(t.res,2) && uC===tC) {
            m.textContent="‚úÖ Richtig!"; m.className="text-green-600 mt-4 font-bold";
            document.getElementById('btn-next-s3').classList.remove('hidden');
            const isLast = this.state.subStep.s3 >= this.state.tasks.s3.length-1;
            document.getElementById('btn-next-s3').textContent = isLast ? "Station abschlie√üen" : "N√§chste Aufgabe ‚ûî";
            document.getElementById('btn-next-s3').onclick = isLast ? () => app.nextStep() : () => app.nextTask3();
        } else {
            m.textContent="‚ùå Pr√ºfe Rechnung & √úbertr√§ge"; m.className="text-red-500 mt-4 font-bold";
        }
    },
    nextTask3() { this.state.subStep.s3++; this.saveState(); this.setupStep3(); },

    /* STATION 4 */
    setupStep4() {
        // Phase 1 (Sim) is only once. If done, show Phase 2 tasks.
        if(!this.state.tasks.step4_1) {
            // Show Phase 1 Sim
            if (!this.state.data || !this.state.data.step4) {
                 this.state.data = this.state.data || {};
                 this.state.data.step4 = {sim:{v1:'110',v2:'111'}, final:{v1:'111',v2:'11',res:'10101',partials:['1110','111']}};
            }
            const sD = this.state.data.step4.sim;
            document.getElementById('sim-val1').textContent = sD.v1;
            const s2C = document.getElementById('sim-val2-container'); s2C.innerHTML='';
            for(let i=0; i<sD.v2.length; i++) {
                const bV=sD.v2[i]; const sP=sD.v2.length-1-i;
                const d=document.createElement('div'); d.className="flex flex-col items-center gap-1";
                const b=document.createElement('button');
                b.className=`w-10 h-10 rounded border-2 flex items-center justify-center font-bold ${bV==='0'?'opacity-30':'hover:bg-blue-100 cursor-pointer color-pos-'+sP}`;
                b.textContent=bV; b.onclick=()=>this.toggleSimBit(b,sP,bV);
                d.appendChild(b); s2C.appendChild(d);
            }
        } else {
            // Setup Phase 2 Task Loop
            document.getElementById('mult-phase-1').classList.add('hidden');
            document.getElementById('mult-phase-2').classList.remove('hidden', 'opacity-0');
            
            const tIdx = this.state.subStep.s4;
            const tasks = this.state.tasks.s4;
            if(tIdx >= tasks.length) { this.nextStep(); return; }

            document.getElementById('s4-progress').textContent = `Aufgabe ${tIdx+1} von ${tasks.length}`;
            const t = tasks[tIdx];
            
            document.getElementById('final-mult-task').textContent = `${t.v1} √ó ${t.v2}`;
            const rC = document.getElementById('final-partial-rows'); rC.innerHTML='';
            for(let i=0; i<t.v2.length; i++) {
                const d=document.createElement('div'); d.className="flex items-center gap-2";
                d.innerHTML=`<span class="text-xs text-slate-400 w-16 text-right">Bit ${t.v2[i]}:</span><input type="text" class="final-p-field bg-slate-800 border border-slate-700 rounded p-2 flex-grow mono text-right" placeholder="...">`;
                rC.appendChild(d);
            }
            document.getElementById('final-mult-res').value="";
            document.getElementById('msg-mult-final').textContent="";
            document.getElementById('btn-next-s4').classList.add('hidden');
        }
    },
    toggleSimBit(btn,s,b) {
        if(b==='0') return;
        const ws=document.getElementById('sim-workspace'); document.getElementById('sim-empty-msg')?.remove();
        if(this.state.simActiveBits.has(s)) {
            btn.classList.remove('bg-pos-'+s,'text-white');
            document.getElementById('blk-'+s).remove();
            this.state.simActiveBits.delete(s);
        } else {
            btn.classList.add('bg-pos-'+s,'text-white');
            this.state.simActiveBits.add(s);
            const d=document.createElement('div'); d.id='blk-'+s; d.className="flex gap-1 animate-fadeIn";
            let h=`<span class="bg-pos-${s} px-2 rounded text-white font-bold">${this.state.data.step4.sim.v1}</span>`;
            for(let k=0; k<s; k++) h+=`<span class="bg-slate-800 px-2 rounded text-slate-600">0</span>`;
            d.innerHTML=h; ws.appendChild(d);
        }
        if(this.state.simActiveBits.size===3) document.getElementById('btn-check-sim').classList.remove('hidden');
    },
    checkSimPhase() { this.state.tasks.step4_1=true; this.saveState(); this.setupStep4(); },
    checkFinalMult() {
        const t = this.state.tasks.s4[this.state.subStep.s4];
        const pF = Array.from(document.querySelectorAll('.final-p-field')).map(f=>this.cleanBin(f.value));
        const uR = parseInt(this.cleanBin(document.getElementById('final-mult-res').value),2);
        
        let pOk = true;
        pF.forEach((v,i) => {
            const rowVal = t.v2[i]==='1' ? (t.v1 + '0'.repeat(t.v2.length-1-i)) : '0'; // Logic check? 
            // Better: use pre-calc partials from task data
            if(parseInt(v,2) !== parseInt(t.p[i],2)) pOk=false;
        });

        const m = document.getElementById('msg-mult-final');
        if(uR === parseInt(t.res,2) && pOk) {
            m.textContent="‚úÖ Korrekt!"; m.className="text-green-500 font-bold";
            document.getElementById('btn-next-s4').classList.remove('hidden');
            const isLast = this.state.subStep.s4 >= this.state.tasks.s4.length-1;
            document.getElementById('btn-next-s4').textContent = isLast ? "Station abschlie√üen" : "N√§chste Aufgabe ‚ûî";
            document.getElementById('btn-next-s4').onclick = isLast ? () => { document.getElementById('next-btn-final').classList.remove('hidden'); document.getElementById('next-btn-final').scrollIntoView({behavior:'smooth'}); } : () => app.nextTask4();
        } else {
            m.textContent="‚ùå Fehler in Zeilen oder Summe"; m.className="text-red-500 font-bold";
        }
    },
    nextTask4() { this.state.subStep.s4++; this.saveState(); this.setupStep4(); },

    /* STATION 6: BONUS */
    setupBonus() {
        const r = document.getElementById('pixel-rows'); r.innerHTML='';
        for(let i=0; i<5; i++) {
            const d=document.createElement('div'); d.className="flex items-center gap-2";
            d.innerHTML=`<span class="text-xs text-slate-400">Z${i+1}</span><input type="text" class="bonus-row bg-slate-800 border border-slate-700 rounded p-2 flex-grow mono text-center tracking-widest text-white" maxlength="5" placeholder="00000" onkeyup="app.updB()">`;
            r.appendChild(d);
        }
        this.updB();
    },
    updB() {
        const p=document.getElementById('user-preview-grid'); p.innerHTML='';
        document.querySelectorAll('.bonus-row').forEach(i=>{
            const v=i.value.padEnd(5,'0');
            for(let c of v) {
                const d=document.createElement('div'); d.className=`w-full aspect-square rounded-sm ${c==='1'?'bg-slate-900':'bg-white border'}`;
                p.appendChild(d);
            }
        });
    },
    checkBonus() {
        const v = Array.from(document.querySelectorAll('.bonus-row')).map(i=>i.value);
        let ok=true; v.forEach((r,i)=>{if(r!==this.state.bonusSolution[i]) ok=false;});
        document.getElementById('bonus-msg').textContent = ok ? "üëæ Perfekt!" : "ü§î Passt noch nicht.";
    },

    /* STATION 7: HEX */
    setupStep7() {
        const tIdx = this.state.subStep.s7;
        const tasks = this.state.tasks.s7;
        if(tIdx >= tasks.length) { this.nextStep(); return; }

        document.getElementById('s7-progress').textContent = `Code ${tIdx+1} von ${tasks.length}`;
        const t = tasks[tIdx];
        
        // Display Binary Chunks
        const disp = document.getElementById('hex-task-display'); disp.innerHTML='';
        const inputs = document.getElementById('hex-inputs'); inputs.innerHTML='';
        
        t.bin.forEach((b,i) => {
            const s = document.createElement('span'); s.className = i%2===0 ? "text-blue-400 mr-2" : "text-green-400 mr-2"; s.textContent=b;
            disp.appendChild(s);
            
            const inp = document.createElement('input'); 
            inp.className = `w-16 h-16 text-center text-2xl font-bold bg-slate-800 border-2 ${i%2===0?'border-blue-500':'border-green-500'} rounded-xl uppercase outline-none hex-inp`;
            inp.maxLength=1;
            inputs.appendChild(inp);
        });
        document.getElementById('hex-msg').textContent="";
        document.getElementById('btn-next-s7').classList.add('hidden');
    },
    checkHex() {
        const t = this.state.tasks.s7[this.state.subStep.s7];
        const inps = Array.from(document.querySelectorAll('.hex-inp')).map(i=>i.value.toUpperCase());
        let ok = true;
        inps.forEach((v,i) => { if(v!==t.hex[i]) ok=false; });
        
        const m = document.getElementById('hex-msg');
        if(ok) {
            m.textContent="‚úÖ Geknackt!"; m.className="text-green-400 font-bold mt-4";
            document.getElementById('btn-next-s7').classList.remove('hidden');
            const isLast = this.state.subStep.s7 >= this.state.tasks.s7.length-1;
            document.getElementById('btn-next-s7').textContent = isLast ? "Zum Finale üèÅ" : "N√§chster Code ‚ûî";
            document.getElementById('btn-next-s7').onclick = isLast ? () => app.nextStep() : () => app.nextTask7();
        } else {
            m.textContent="‚ùå Falscher Code"; m.className="text-red-400 font-bold mt-4";
        }
    },
    nextTask7() { this.state.subStep.s7++; this.saveState(); this.setupStep7(); },

    /* FINAL */
    selectQuizOpt(btn, v) { this.state.q3Ans=v; document.querySelectorAll('.quiz-opt').forEach(b=>b.classList.remove('bg-slate-200')); btn.classList.add('bg-slate-200'); },
    checkFinalQuiz() {
        const q1 = parseInt(document.getElementById('ans-q1').value);
        const q2 = parseInt(this.cleanBin(document.getElementById('ans-q2').value),2);
        let s=0; 
        if(q1===45) { s++; document.getElementById('q1').classList.add('border-green-500'); }
        if(q2===16) { s++; document.getElementById('q2').classList.add('border-green-500'); }
        if(this.state.q3Ans===32) { s++; document.getElementById('q3').classList.add('border-green-500'); }
        
        const r = document.getElementById('quiz-result'); r.classList.remove('hidden');
        r.textContent = s===3 ? "üèÜ 3/3 - Perfekt!" : `Ergebnis: ${s}/3`;
        if(s===3) confetti({particleCount:300});
    }
};
window.onload = () => app.init();
</script>
</body>
</html>
